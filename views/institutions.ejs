<%- include('header') %>

<% if (institutions.length === 0) { %>
<div class="alert alert-info" role="alert">
    <p>There are no institutions to show, click <a href="/addInstitution">here</a> to add an institution.</p>
</div>
<% } else { %>
    <br>

    <a type="button" class="btn btn-primary" href="/addInstitution">Add institution</a>
    
    <script>

        $.noConflict();
        jQuery(document).ready(function( $ ) {
            $('#employeesByInstitution').dialog({
                autoOpen: false,
                modal: true,
                overlay: {
                    opacity: 0.7,
                    background: "black"
                },
                buttons: {
                    "VIEW": function() {
                        // get variables and load employees
                        var id = $('#dialogId').val();
                        var type = $('#dialogType').val();
                        
                        var link = "/getEmployeeByInstitutionId/" + id + "/" + type;
                        if (id && type) {
                            window.location = link;
                        } else {
                            window.location = "/getAllInstitutions";
                        }
                    },
                    "CANCEL": function() {
                        $(this).dialog('close');
                    }
                }
            });

            $('#employeesByInstitutionButton').click(function() {
                $('#employeesByInstitution').dialog('open');
            });
        });

        function editInstitution() {
            var id = prompt("Please enter institution ID:");
            link = "/editInstitutionById/" + id;
            if (id) {
                window.location = link;
            } else {
                window.location = "/getAllInstitutions";
            }
        }

        function deleteInstitution() {
            var id = prompt("Please enter institution ID:");
            link = "/deleteInstitutionById/" + id;
            if (id) {
                confirm('This will delete the entire institution. Are you sure you want proceed?');
                window.location = link;
            } else {
                window.location = "/getAllInstitutions";
            }
        }
    </script>

    <a type="button" class="btn btn-primary" id="employeesByInstitutionButton" href="#">Get employees</a>
    <a type="button" class="btn btn-primary" onClick="editInstitution()" href="#">Edit institution</a>
    <a type="button" class="btn btn-primary" onClick="deleteInstitution()" href="#">Delete institution</a>
    <a type="button" class="btn btn-primary" href="/generateInstitutionsDocument">Generate institution docs</a>
    <a type="button" class="btn btn-primary" href="/institutionsDocuments">View institution docs</a>
    
    <br><br>

    <div title="Institution information" id="employeesByInstitution" style="display:none;">
        <div class="modal-body">
            <form>
                <label>Institution ID</label>
                <input type="text" id="dialogId"/>
                <label>Institution Type</label>
                <select class="custom-select" id="dialogType" required>
                    <% types.forEach(function(type, index) { %>
                        <option value="<%= type.TIP_UST %>"><%= type.TIP_NAZIV %></option>
                    <% }); %>
                </select>
            </form>
        </div>
    </div>

    <table class="table">
        <thead class="thead-dark">
            <tr>
                <th scope="col">#</th>
                <th scope="col">ID</th>
                <th scope="col">Country</th>
                <th scope="col">Institution Name</th>
                <th scope="col">Type</th>
            </tr>
        </thead>
        <tbody>
            <% institutions.forEach(function(institution, index) { %>
            <tr>
                <td><strong><%= index+1 %></strong></td>
                <td><%= institution.VU_IDENTIFIKATOR %></td>
                <td><%= institution.DR_IDENTIFIKATOR %></td>
                <td><%= institution.VU_NAZIV %></td>
                <td><%= institution.TIP_UST %></td>
            </tr>
            <% }); %>
        </tbody>
    </table>
<% } %>

<%- include('footer') %>